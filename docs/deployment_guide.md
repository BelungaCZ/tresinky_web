üè† [–ì–ª–∞–≤–Ω–∞—è](../README.md) | üìã [Changelog](../CHANGELOG.md) | üíª [Implementation Plan](../IMPLEMENTATION_PLAN.md) | üöÄ [Environment Setup](environment_setup.md)

---

# Deployment Guide

## Prerequisites

1. Docker and Docker Compose installed
2. Git installed
3. Access to the server
4. Domain name configured
5. SSL certificates (self signed for development; for production SSL certificates will be managed by Let's Encrypt)

## Initial Setup

1. Clone the repository:
   ```bash
   git clone https://github.com/your-username/Tresinky_web.git
   cd Tresinky_web
   ```

2. Create environment files:
   ```bash
   # Development
   cp .env.example .env.development
   
   # Production
   cp .env.example .env.production
   ```

3. Configure environment variables:
   - Update `.env.development` for local development
   - Update `.env.production` for production deployment: 
   ```bash
   FLASK_ENV=production
   DEBUG=false
   ```


## Development Deployment

1. Generate self signed SSL certificate for development:
   ```bash
   ./scripts/generate_ssl.sh 
   ```

2. Switch to development environment:
   ```bash
   ./scripts/switch_env.sh development
   ```

3. Start the services:
   ```bash
   docker compose up -d
   ```
      or 
   ```bash
   flask run --host=0.0.0.0 --port=5000 
   ```

4. Access the application:
   - Web: http://localhost:5000
   - Admin: http://localhost:5000/admin

## Production Deployment

1. SSL certificates will be managed by Let's Encrypt.

2. Switch to production environment:
   ```bash
   ./scripts/switch_env.sh production
   ```

3. Setup secret key:
   ```bash
   ./scripts/update_secret_key.sh production
   ```

4. Start the services:
   ```bash
   docker compose up -d
   ```

5. Verify the deployment:
   - Check response: `curl -I http://sad-tresinky-cetechovice.cz`
   - Check response: `curl -I https://sad-tresinky-cetechovice.cz`
   - Check application logs: `docker compose logs web`
   - Check Nginx logs: `docker compose logs nginx`
   - Test HTTPS: https://sad-tresinky-cetechovice.cz

## Database Management

### Backup
```bash
# Backup database
cp instance/tresinky.db instance/tresinky.db.backup

# Backup with timestamp
cp instance/tresinky.db instance/tresinky.db.$(date +%Y%m%d_%H%M%S)
```

### Restore
```bash
# Restore from backup
cp instance/tresinky.db.backup instance/tresinky.db
```

## SSL Certificate Management

### Development
- Use self-signed certificates generated by `scripts/generate_ssl.sh`
- Certificates stored in `ssl/` directory

### Production
1. SSL certificates will be managed by Let's Encrypt.
2. Update Nginx configuration if needed

## Monitoring

### Logs
```bash
# Application logs
docker compose logs web

# Nginx logs
docker compose logs nginx

# Follow logs
docker compose logs -f web
```

### Health Checks
1. Application: http://localhost:5000/health
2. Nginx: http://localhost/health

## Updates and Maintenance

### Application Updates
1. Pull latest changes:
   ```bash
   git pull origin main
   ```

2. Rebuild and restart:
   ```bash
   docker compose down
   docker compose up -d --build
   ```

### Database Updates
1. Backup current database
2. Apply migrations if needed
3. Verify data integrity

### SSL Certificate Renewal
1. Reload Nginx:
   ```bash
   docker compose restart nginx
   ```

## Troubleshooting

### Common Issues

1. Application Not Starting
   ```bash
   # Check logs
   docker compose logs web
   
   # Check container status
   docker compose ps
   ```

2. Nginx Issues
   ```bash
   # Check Nginx configuration
   docker compose exec nginx nginx -t
   
   # Check Nginx logs
   docker compose logs nginx
   ```

3. Database Issues
   ```bash
   # Check database file
   ls -l instance/tresinky.db
   
   # Check database logs
   docker compose logs db
   ```

### Performance Issues

1. Check resource usage:
   ```bash
   docker stats
   ```

2. Monitor logs for errors:
   ```bash
   docker compose logs -f
   ```

3. Check Nginx access logs:
   ```bash
   docker compose exec nginx tail -f /var/log/nginx/access.log
   ```

## Security Checklist

1. Environment Variables
   - [ ] Strong secret keys
   - [ ] Production settings
   - [ ] Secure database credentials

2. SSL/TLS
   - [ ] Valid certificates
   - [ ] Proper configuration
   - [ ] Regular renewal

3. Nginx
   - [ ] Security headers
   - [ ] SSL configuration
   - [ ] Access restrictions
   - [ ] HTTP2 support

4. Application
   - [ ] Debug mode disabled
   - [ ] Secure session settings
   - [ ] Input validation

## Backup and Recovery

### Regular Backups
1. Database
2. SSL certificates
3. Configuration files
4. Uploaded gallery files

### Recovery Procedure
1. Stop services
2. Restore backups
3. Verify configuration
4. Start services

## Scaling

### Vertical Scaling
1. Increase container resources
2. Optimize Nginx configuration
3. Enable caching

### Horizontal Scaling
1. Load balancer setup
2. Database replication
3. Session management

## Maintenance Schedule

### Daily
- Monitor logs
- Check application status
- Verify backups

### Weekly
- Review security logs
- Check SSL certificates
- Monitor performance

### Monthly
- Update dependencies
- Review security settings
- Optimize configuration
- Check disk space

## Support

For issues and support:
1. Check documentation
2. Review logs
3. Contact development team 

---

## üîó –°–º. —Ç–∞–∫–∂–µ

- **üè† [–ì–ª–∞–≤–Ω–∞—è](../README.md)** - –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- **üöÄ [Environment Setup](environment_setup.md)** - –î–µ—Ç–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **üíª [Implementation Plan](../IMPLEMENTATION_PLAN.md)** - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **üìã [Changelog](../CHANGELOG.md)** - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞
- **‚¨ÖÔ∏è [–ù–∞–∑–∞–¥: Environment Setup](environment_setup.md)** | **‚û°Ô∏è [–î–∞–ª–µ–µ: Changelog](../CHANGELOG.md)** 